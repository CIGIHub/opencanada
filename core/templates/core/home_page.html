{% extends "base.html" %}

{% load static core_tags wagtailcore_tags article_tags wagtailimages_tags %}

{% block feedlink %}<link rel="alternate" type="application/rss+xml" href="feed/" />{% endblock feedlink %}

{% block body_class %}template-{{ self.get_verbose_name|slugify }}{% endblock %}

{% block extra_js %}
<script>
    FeatureStyles.MainFeatures.setSize({{ self.full_bleed_image_size }});
</script>
{% endblock %}

{% block feature %}
    {% include 'core/main-feature.html' %}
{% endblock %}


{% block content %}
    <section class="container features" id="features">
        <h2>Most Recent</h2>

        {% for row in self.articles %}
            <div class="row {% if forloop.last %}last{% endif %}">
            {% for article in row %}
                <div class="col-sm-{{ row|column_class }} feature-item overlay {% if forloop.first %}first{% endif %} {% if forloop.last %}last{% endif %}">
                    {% if article.feature_style.include_image and article.feature_style.overlay_text %}
                        <div class="overlay-feature rowheight-{{ article.feature_style.number_of_rows }}">
                            {% if article.editors_pick %}
                                <div class="editors-pick-link"><div class="table"><div class="table-cell"><a href="{% slugurl 'editors-picks' %}" class="article-feature editors-pick">Editor's Pick</a></div></div></div>
                            {% endif %}
                            {% if article == self.most_popular_article %}
                                <a href="{% slugurl 'most-popular' %}"><div class="article-feature most-popular"><div>Most Popular</div></div></a>
                            {% endif %}
                            {% if article.feature_style.number_of_rows == 2 %}
                                {% image article.main_image fill-910x560 as background_image %}
                            {% else %}
                                {% image article.main_image fill-910x280 as background_image %}
                            {% endif %}
                            <div class="feature-image" style="background-image: url('{{ background_image.url }}')">
                                <a href="{{ article.url }}"><div class="feature-image-overlay" style="background: rgba( {{ article.image_overlay_color.rgb }}, {{ article.opacity }} )"></div></a>
                            </div>
                            <div class="feature-wrapper">
                                <div class="feature-text {% if article.editors_pick %} editors-pick{% endif %}" style="color: {{ article.font_style.text_colour.hex_value }};">
                                    {% if article.feature_style.number_of_rows == 1 %}
                                        <h3><a style="color: {{ article.font_style.text_colour.hex_value }};" href="{{ article.url }}">{{ article.title }}</a></h3>
                                        {% if article.subtitle %}
                                            <div class="feature-line">{{ article.subtitle|richtext }}</div>
                                        {% else %}
                                            <div class="feature-line">{{ article.excerpt|richtext }}</div>
                                        {% endif %}
                                    {%  else %}
                                        <h3 class="double-height"><a style="color: {{ article.font_style.text_colour.hex_value }};" href="{{ article.url }}">{{ article.title }}</a></h3>
                                    {% endif %}

                                    {% if article.authors %}
                                        {% spaceless %}
                                        <div class="contributors">By:
                                            {% for author in article.authors %}
                                                <a href="{{ author.url }}" style="color: {{ article.font_style.text_colour.hex_value }};">
                                                    {{ author.full_name }}
                                                </a><span>{% if not forloop.last %}, {% endif %}</span>
                                            {% endfor %}
                                        </div>
                                    {% endspaceless %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="camera"><i class="fa fa-camera"></i></div>
                        </div>

                    {% elif article.feature_style.include_image and not article.feature_style.overlay_text %}
                        <div class="image-feature">
                            {% if article.editors_pick %}
                                <div class="editors-pick-link"><div class="table"><div class="table-cell"><a href="{% slugurl 'editors-picks' %}" class="article-feature editors-pick">Editor's Pick</a></div></div></div>
                            {% endif %}
                            {% if article == self.most_popular_article %}
                                <a href="{% slugurl 'most-popular' %}"><div class="article-feature most-popular"><div>Most Popular</div></div></a>
                            {% endif %}
                            <figure><a href="{{ article.url }}">{%  image article.main_image fill-710x475 %}</a></figure>
                            <h3><a href="{{ article.url }}">{{ article.title }}</a></h3>
                           {% spaceless %}
                                <div class="contributors">By:
                                    {% for author in article.authors %}
                                        <a href="{{ author.url }}">{{ author.full_name }}</a><span>{% if not forloop.last %}, {% endif %}</span>
                                    {% endfor %}
                                </div>
                           {% endspaceless %}
                        </div>

                    {% else %}
                        <div class="simple-feature">
                            {% if article.editors_pick %}
                                <div class="editors-pick-link"><div class="table"><div class="table-cell"><a href="{% slugurl 'editors-picks' %}" class="article-feature editors-pick">Editor's Pick</a></div></div></div>
                            {% endif %}
                            {% if article == self.most_popular_article %}
                                <a href="{% slugurl 'most-popular' %}"><div class="article-feature most-popular"><div>Most Popular</div></div></a>
                            {% endif %}
                            <h3 class="{% if article.editors_pick %} editors-pick{% endif %}"><a href="{{ article.url }}">{{ article.title }}</a></h3>
                            {% spaceless %}
                                <div class="contributors">By:
                                    {% for author in article.authors %}
                                        <a href="{{ author.url }}">{{ author.full_name }}</a><span>{% if not forloop.last %}, {% endif %}</span>
                                    {% endfor %}
                                </div>
                        {% endspaceless %}

                            {% if article.subtitle %}
                                <div class="feature-line">{{ article.subtitle|richtext }}</div>
                            {% else %}
                                <div class="feature-line">{{ article.excerpt|richtext }}</div>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>

                {% endfor %}

            </div>
        {% endfor %}
        <div class="read-more">
            <a class="button" href="{% slugurl 'features' %}">All Features <i class="fa fa-chevron-right"></i></a>
        </div>
    </section>

    {% include 'core/includes/section-circle-descriptions.html' with heading_text="In-Depths" item_collection=self.series use_ring=False more_link_slug='indepth' more_link_text='More In-Depths' %}

    {% include 'core/includes/section-circle-descriptions.html' with heading_text="Best of the Web" item_collection=self.external_articles use_ring=True more_link_slug='readings' more_link_text='More from the Web' %}

    {% include 'core/includes/section-simple.html' with heading_text="Graphics" item_collection=self.graphics  more_link_slug='visualizations' more_link_text='More Graphics' %}

{% endblock %}
